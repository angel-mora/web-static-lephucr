---
title: Slug uniqueness error fix
tags:
- update
created: '2025-07-19'
updated: '2025-07-19'
summary:
draft: false
---

# Slug uniqueness error fix

## âœ… TODOs


## ðŸ“Œ Summary
An ActiveRecord::RecordNotUnique occurred in videos#update:

## ðŸ§  Full Chat


An ActiveRecord::RecordNotUnique occurred in videos#update:

  Mysql2::Error: Duplicate entry 'webinar-bring-employees-back-to-the-workplace-amid-the-covid-19-' for key 'friendly_id_slugs.index_friendly_id_slugs_on_slug_and_sluggable_type_and_scope'
  app/controllers/admin/videos_controller.rb:104:in `update'




The `ActiveRecord::RecordNotUnique` error you're seeing typically occurs when you try to create or update a record with a `slug` that already exists for the same scope in the database. In this case, the error indicates that the `slug` generated by FriendlyId (`webinar-bring-employees-back-to-the-workplace-amid-the-covid-19-`) already exists, which violates the unique constraint on that column.

### Solutions:

1. **Modify the Slug Generation**:
   - Update your model configuration for FriendlyId to handle duplicates by appending a suffix (like a counter) to make the `slug` unique.
   - For example, you can use `FriendlyId` with the `:history` module or configure it to add a numeric sequence to the end of duplicate slugs.

   ```ruby
   extend FriendlyId
   friendly_id :title, use: [:slugged, :history]
   
   def should_generate_new_friendly_id?
     title_changed? || slug.blank?
   end
   ```

2. **Handle the Conflict in the Controller**:
   - In your `update` action, rescue from `ActiveRecord::RecordNotUnique` and retry with a unique `slug` or notify the user.

   ```ruby
   def update
     @video = Video.find(params[:id])
     if @video.update(video_params)
       redirect_to @video, notice: 'Video updated successfully.'
     end
   rescue ActiveRecord::RecordNotUnique
     @video.slug = nil
     retry
   end
   ```

3. **Database Check**:
   - If this is happening frequently, check for existing records with duplicate `slugs` and update them to ensure uniqueness across your records.

After making these changes, try updating your `videos#update` action again. Let me know if this resolves the issue or if further adjustments are needed!